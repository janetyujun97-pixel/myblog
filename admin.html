<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>写文章 · My Blog</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>

<!-- ===== HEADER ===== -->
<header class="site-header">
  <div class="header-inner">
    <a href="index.html" class="site-logo">M<span>.</span>Blog</a>
    <div style="flex:1"></div>
    <div class="header-actions">
      <button class="btn-icon" id="themeToggle" title="切换主题">
        <svg id="themeIconSun" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
          <line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
        </svg>
        <svg id="themeIconMoon" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" style="display:none">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
      </button>
      <a href="index.html" class="btn-admin">
        <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
          <polyline points="9 22 9 12 15 12 15 22"/>
        </svg>
        <span>返回首页</span>
      </a>
    </div>
  </div>
</header>

<!-- ===== MAIN ===== -->
<main class="page-body">
  <div class="container">
    <div class="admin-layout">

      <!-- ===== SIDEBAR ===== -->
      <aside class="admin-sidebar">

        <!-- Post list -->
        <div class="sidebar-card">
          <h3>已发布文章</h3>
          <div class="posts-list-admin" id="adminPostList">
            <!-- rendered by JS -->
          </div>
          <button class="btn-sm" id="btnNewPost" style="width:100%;margin-top:14px;justify-content:center;display:flex;align-items:center;gap:6px;">
            <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
              <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
            新建文章
          </button>
        </div>

        <!-- Category manager -->
        <div class="sidebar-card">
          <h3>分类管理</h3>
          <div class="cat-list" id="catList"></div>
          <div class="add-cat-row">
            <input type="text" id="newCatInput" placeholder="新分类名称…" maxlength="10" />
            <button class="btn-sm" id="btnAddCat">添加</button>
          </div>
        </div>

      </aside>

      <!-- ===== FORM ===== -->
      <div class="form-card" id="formCard">
        <h2 id="formTitle">写新文章</h2>

        <!-- Title -->
        <div class="form-group">
          <label>标题 <span style="color:var(--accent)">*</span></label>
          <input type="text" class="form-control" id="inputTitle" placeholder="给这篇文章起个标题…" maxlength="80" />
        </div>

        <!-- Category & Featured -->
        <div class="form-row">
          <div class="form-group">
            <label>分类</label>
            <select class="form-control" id="inputCategory"></select>
          </div>
          <div class="form-group">
            <label>设为精选</label>
            <div class="toggle-row">
              <span>在首页顶部展示</span>
              <div class="toggle" id="featuredToggle"><div class="toggle-knob"></div></div>
            </div>
          </div>
        </div>

        <!-- Cover image URL -->
        <div class="form-group">
          <label>封面图片 URL（可选）</label>
          <input type="url" class="form-control" id="inputCoverUrl" placeholder="https://… 或留空" />
        </div>

        <!-- Content editor -->
        <div class="form-group">
          <label>正文内容 <span style="color:var(--accent)">*</span></label>
          <div class="editor-toolbar">
            <button class="editor-btn" data-cmd="bold" title="加粗"><b>B</b></button>
            <button class="editor-btn" data-cmd="italic" title="斜体"><i>I</i></button>
            <button class="editor-btn" data-cmd="underline" title="下划线"><u>U</u></button>
            <button class="editor-btn" data-cmd="strikeThrough" title="删除线"><s>S</s></button>
            <div style="width:1px;background:var(--border);margin:0 4px;height:18px;align-self:center"></div>
            <button class="editor-btn" data-cmd="formatBlock" data-val="h2" title="标题">H2</button>
            <button class="editor-btn" data-cmd="formatBlock" data-val="h3" title="小标题">H3</button>
            <button class="editor-btn" data-cmd="formatBlock" data-val="p" title="正文">¶</button>
            <div style="width:1px;background:var(--border);margin:0 4px;height:18px;align-self:center"></div>
            <button class="editor-btn" data-cmd="insertUnorderedList" title="无序列表">• 列表</button>
            <button class="editor-btn" data-cmd="insertOrderedList" title="有序列表">1. 列表</button>
            <button class="editor-btn" data-cmd="formatBlock" data-val="blockquote" title="引用">❝</button>
            <div style="width:1px;background:var(--border);margin:0 4px;height:18px;align-self:center"></div>
            <button class="editor-btn" id="btnInsertLink" title="插入链接">🔗</button>
          </div>
          <div
            class="editor-area"
            id="editorArea"
            contenteditable="true"
            data-placeholder="开始写作…"
          ></div>
        </div>

        <!-- Images upload -->
        <div class="form-group">
          <label>上传图片（可多张）</label>
          <div class="upload-area" id="uploadArea">
            <div class="upload-area-icon">
              <svg width="32" height="32" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                <rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/>
                <polyline points="21 15 16 10 5 21"/>
              </svg>
            </div>
            <p class="upload-area-text">点击选择图片或拖拽到此处</p>
            <p class="upload-area-sub">支持 JPG、PNG、GIF、WebP（单张最大 5MB）</p>
          </div>
          <input type="file" id="fileInput" accept="image/*" multiple />
          <div class="preview-grid" id="previewGrid"></div>
        </div>

        <!-- Video URL -->
        <div class="form-group">
          <label>视频链接（可选）</label>
          <input type="url" class="form-control" id="inputVideoUrl" placeholder="YouTube / Bilibili / 直链 MP4…" />
          <p style="font-size:.78rem;color:var(--text-3);margin-top:6px;">支持 YouTube、Bilibili 等平台链接</p>
        </div>

        <!-- Tags -->
        <div class="form-group">
          <label>标签（逗号分隔）</label>
          <input type="text" class="form-control" id="inputTags" placeholder="旅行, 摄影, 生活…" />
        </div>

        <!-- Excerpt -->
        <div class="form-group">
          <label>摘要（可选，留空将自动生成）</label>
          <textarea class="form-control" id="inputExcerpt" rows="2" placeholder="简短描述这篇文章…"></textarea>
        </div>

        <!-- Actions -->
        <div class="form-actions">
          <button class="btn-primary" id="btnSubmit">
            <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
              <polyline points="20 6 9 17 4 12"/>
            </svg>
            <span id="btnSubmitLabel">发布文章</span>
          </button>
          <button class="btn-secondary" id="btnClear">清空重填</button>
        </div>

      </div>

    </div>
  </div>
</main>

<div class="toast" id="toast"></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script src="js/data.js"></script>
<script src="js/admin.js"></script>
</body>
</html>
